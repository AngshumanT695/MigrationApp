<header class="app-header mat-elevation-z3">
  <h1>Ng-Migration</h1>
</header>

<mat-sidenav-container class="main-container bg-dark">
  <mat-sidenav mode="side" opened class="side-drawer">

    <div class="d-flex flex-column h-100">
      <h2 class="px-3 pt-3">CONFIGURE</h2>
      <div class="px-3 flex-grow-1 overflow-auto">

        <form #fileSelectForm="ngForm" [class.d-none]="config?.projectPath && !onFileSelectError">
          <p>Select package.json of your Angular Project</p>
          <button mat-raised-button color="primary" class="w-100" (click)="choosePath()">Select package.json</button>
          <input type="file" #fileInput ngModel name="fileInput" class="d-none" accept=".json"
            (change)="onFileSelect($event)">
          <small class="d-block mt-2 text-danger">{{ onFileSelectError }}</small>
        </form>

        <ng-container *ngIf="config?.projectPath && !onFileSelectError">

          <div class="mb-3">
            <h5 class="text-secondary m-0">Root Directory:</h5>
            <p class="text-truncate" [attr.title]="config.projectPath">{{ config.projectPath }}</p>
          </div>

          <ng-container *ngIf="!availableVersionsLoading">

            <div class="d-flex">
              <mat-form-field class="w-50 mr-2">
                <mat-label>Current Version</mat-label>
                <input matInput [value]="config.currentVersion" readonly disabled>
              </mat-form-field>
              <mat-form-field class="w-50">
                <mat-label>Update To</mat-label>
                <mat-select [(value)]="config.targetVersion" (valueChange)="onSelectTargetVersion()">
                  <mat-option *ngFor="let version of availableVersions" [value]="version">{{ version }}</mat-option>
                </mat-select>
              </mat-form-field>
            </div>

            <small *ngIf="onVersionSelectError" class="d-block mb-3 text-danger text-danger">
              {{ onVersionSelectError }}
            </small>

            <div class="mb-3">
              <h3 class="mb-1">FLAGS</h3>
              <mat-checkbox class="pr-4" [(ngModel)]="config.dryRun" (ngModelChange)="onFlagChange('dryRun')">
                Dry Run
              </mat-checkbox>
              <mat-checkbox [(ngModel)]="config.force" (ngModelChange)="onFlagChange('force')">
                Force Run
              </mat-checkbox>
            </div>

            <mat-accordion *ngIf="!advanceOptionsLoading && !onVersionSelectError && advanceOptionsList?.length > 0">
              <mat-expansion-panel>
                <mat-expansion-panel-header>
                  <mat-panel-title>
                    Advanced Options
                  </mat-panel-title>
                </mat-expansion-panel-header>
                <div>
                  <mat-selection-list *ngIf="advanceOptionsList?.length > 0" [(ngModel)]="this.config.beforeChanges"
                    [compareWith]="beforeUpgradeListCompareWith">
                    <h5 class="m-0 pb-2">Migrations before updating</h5>
                    <mat-list-option checkboxPosition="before" *ngFor="let option of advanceOptionsList"
                      [value]="option">
                      {{option.description}}
                    </mat-list-option>
                  </mat-selection-list>
                </div>
              </mat-expansion-panel>
            </mat-accordion>

          </ng-container>

        </ng-container>

        <app-loader *ngIf="isLoading" [loadingMessage]="isLoading"></app-loader>

      </div>

      <div class="px-3 py-2 toolbar-footer d-flex">
        <button mat-raised-button class="w-50 mr-2" [disabled]="!config?.projectPath" (click)="reset()">Reset</button>
        <button mat-raised-button color="primary" class="w-50" [disabled]="true">Run</button>
      </div>
    </div>

  </mat-sidenav>

  <mat-sidenav-content>

    <div *ngIf="terminalMessage === undefined" class="fresh-start text-secondary"
      (click)="(!config?.projectPath || onFileSelectError) && choosePath()">
      <img class="fresh-start-icon" src="assets/renovate.svg">
      <p>
        Select the package.json file of your angular application to begin.
      </p>
    </div>

    <app-terminal *ngIf="terminalMessage !== undefined" class="p-3" [message]="terminalMessage"></app-terminal>

  </mat-sidenav-content>
</mat-sidenav-container>
